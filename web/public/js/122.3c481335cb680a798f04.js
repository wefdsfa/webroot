webpackJsonp([122],{lVxi:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});s("wHeh");var a=s("C331"),i={created:function(){var t=this,e=localStorage.getItem("lang");Object(a.f)(e)&&(this.lang=e),this.roleColumns=[{id:"roleName",title:"角色名",className:"text-left",hidden:!1,width:200,search:{type:"input",data:{placeholer:"",autoFocus:!0}},formatter:function(t){return t.name}},{id:"remark",title:"角色说明",width:120,className:"text-left",hidden:!1},{id:"userName",title:"用户",width:120,className:"text-left",hidden:!1,hover:!1,formatter:function(t){var e="";return 0===t.roleUsers.length?e:(t.roleUsers.forEach(function(t){e+="<span title="+t+">"+t.user.name+"</span>,"}),e.substring(0,e.length-1))}},{id:"opt",title:this.translate.opt,className:"text-centet",width:130,hidden:!1,formatter:function(e){return[{tag:"a",text:"编辑",callback:function(e,s){t.modalStatus.showEidtModal=!0,t.editRoleJson={roleId:e.id,name:e.name,remark:e.remark,userInfo:"",userId:"",roleUsers:[],isShowSearch:!0},e.roleUsers.forEach(function(e){t.editRoleJson.roleUsers.push({name:e.user.name,userId:e.user.userId})})}},{tag:"a",text:"配置",className:"opt-btn",callback:function(e,s){t.modalStatus.showSettingModal=!0,t.permissionSetting.roleId=e.id,Object(a.d)({url:"/api/apartment/roles/menuAndArea/"+e.id,dataType:"json",type:"get",success:function(e){e.state?(t.permissionSetting.roleAreas=e.data.roleAreas,t.permissionSetting.roleMenu=e.data.roleMenu,t.permissionSetting.defaultValue.parkId="",t.permissionSetting.defaultValue.buildingId="",t.permissionSetting.selected=[],e.data.roleMenu.length>0&&e.data.roleMenu.forEach(function(e){t.permissionSetting.selected.push(e.menuId)})):t.$toast(e.message)}})}},{tag:"a",text:"删除",className:"opt-btn",callback:function(e,s){confirm("确定要删除吗？")&&Object(a.d)({url:"/api/apartment/roles/"+e.id,dataType:"json",type:"delete",success:function(e){e.state?(t.toast("删除成功"),t._refreshTable()):t.$toast(e.message)}})}}]}}],this.userColumns=[{id:"userNo",title:"工号",className:"text-left",hidden:!1,width:200,search:{type:"input",data:{placeholer:"",autoFocus:!0}}},{id:"name",title:"姓名",className:"text-left",hidden:!1,width:200,search:{type:"input",data:{placeholer:"",autoFocus:!0}}},{id:"roleName",title:"角色",className:"text-left",hidden:!1},{id:"college",title:"学院",className:"text-left",hidden:!1}],this._getSettingData()},data:function(){return{roleUrl:"/table-data/apartment/roles/page",userUrl:"/table-data/apartment/roles/roleUser/page",roleColumns:[],userColumns:[],curRoute:"role",modalStatus:{showEidtModal:!1,showAddModal:!1,showSettingModal:!1},addRoleJson:{name:"",remark:""},editRoleJson:{roleId:"",name:"",remark:"",userInfo:"",userId:"",roleUsers:[],isShowSearch:!0},permissionSetting:{permissionArray:[],selected:[],campusArray:[],parkArray:[],buildingArray:[],defaultValue:{campus:"",campusId:"",park:"",parkId:"",building:[],buildingId:""},roleId:"",roleMenu:[],roleAreas:[],campusIds:[],zoneIds:[]},timeStamp:"",lang:"zh-cn"}},computed:{translate:function(){return Object(a.f)(this.lang).accommodationStaff}},methods:{_getparkData:function(){var t=this;Object(a.d)({url:"/api/apartment/zones/getByCampuses?campusIds="+this.permissionSetting.campusIds,dataType:"json",type:"get",success:function(e){e.state?t.permissionSetting.parkArray=e.data||[]:t.$toast(e.message)}})},_getBuildingData:function(){var t=this;Object(a.d)({url:"/api/apartment/buildings/getWithConditions?campusIds="+this.permissionSetting.campusIds+"&zoneIds="+this.permissionSetting.zoneIds,dataType:"json",type:"get",success:function(e){e.state?t.permissionSetting.buildingArray=e.data||[]:t.$toast(e.message)}})},_getSettingData:function(){var t=this;Object(a.d)({url:"/api/apartment/roles/menu",dataType:"json",type:"get",success:function(e){e.state?t.permissionSetting.permissionArray=e.data:t.$toast(e.message)}}),Object(a.d)({url:"/api/apartment/dicts?typeName=校区",dataType:"json",type:"get",success:function(e){e.state?(t.permissionSetting.campusArray=e.data||[],e.data&&e.data.length>0&&(t.permissionSetting.defaultValue.campusId=e.data[0].value)):t.$toast(e.message)}})},showAddRoleModal:function(){this.modalStatus.showAddModal=!0,this.addRoleJson={name:"",remark:""}},sumbitAddRole:function(){var t=this;if(!this.addRoleJson.name)return this.$toast("请输入角色名");Object(a.d)({url:"/api/apartment/roles",dataType:"json",type:"post",data:this.addRoleJson,success:function(e){e.state?(t.toast("新增成功"),t.modalStatus.showAddModal=!1,t._refreshTable()):t.$toast(e.message)}})},sumbitEditRole:function(){var t=this;Object(a.d)({url:"/api/apartment/roles/"+this.editRoleJson.roleId,dataType:"json",type:"put",data:{name:this.editRoleJson.name,remark:this.editRoleJson.remark,roleUsers:this.editRoleJson.roleUsers},success:function(e){e.state?(t.toast("编辑成功"),t.modalStatus.showEidtModal=!1,t._refreshTable()):t.$toast(e.message)}})},submitSettingRole:function(){var t=this;Object(a.d)({url:"/api/apartment/roles/setting/"+this.permissionSetting.roleId,dataType:"json",type:"put",data:{roleAreas:this.permissionSetting.roleAreas,roleMenu:this.permissionSetting.roleMenu},success:function(e){e.state?(t.$toast("配置成功"),t.modalStatus.showSettingModal=!1,t._refreshTable()):t.$toast(e.message)}})},userSelected:function(t){this.editRoleJson.userId=t.userId,this.editRoleJson.userInfo=t.name+" ("+t.userNo+")",this.editRoleJson.roleUsers.push({name:t.name,userId:t.userId}),this.editRoleJson.isShowSearch=!1},changeUserSearch:function(){this.editRoleJson.isShowSearch=!0,this.editRoleJson.userInfo="",this.editRoleJson.userId=""},removeUser:function(t){var e=this;this.editRoleJson.roleUsers.forEach(function(s,a){s.userId===t&&e.editRoleJson.roleUsers.splice(a,1)})},permissionSelected:function(t){var e=this,s=this.permissionSetting.selected.indexOf(t.id);s>=0?(this.permissionSetting.selected.splice(s,1),this.permissionSetting.roleMenu.forEach(function(s,a){t.id===s.menuId&&e.permissionSetting.roleMenu.splice(a,1)})):t.name&&(this.permissionSetting.selected.push(t.id),this.permissionSetting.roleMenu.push({roleId:this.permissionSetting.roleId,menuId:t.id}))},addArea:function(){var t=this,e=this.permissionSetting.defaultValue.campus,s=this.permissionSetting.defaultValue.park,a=this.permissionSetting.defaultValue.building;if(this.permissionSetting.campusArray.length>0&&!e)return this.$toast("请选择校区");if(e&&a.length>0&&this.permissionSetting.parkArray.length>0&&!s)return this.$toast("请选择园区");var i=[],o=[];if(this.permissionSetting.parkArray.length>0&&(s?i.push({title:e+s,campus:this.permissionSetting.defaultValue.campusId,zoneId:this.permissionSetting.defaultValue.parkId}):this.permissionSetting.parkArray.forEach(function(s,a){var o=e+s.name;i.push({title:o,campus:t.permissionSetting.defaultValue.campusId,zoneId:s.zoneId})})),this.permissionSetting.buildingArray.length>0&&(0===a.length?i.forEach(function(e,s){t.permissionSetting.buildingArray.forEach(function(t,s){var a=e.title+t.name;o.push({title:a,campus:e.campus,zoneId:e.zoneId,buildingId:t.buildingId})})}):i.forEach(function(t,e){a.forEach(function(e,s){var a=t.title+e;o.push({title:a,campus:t.campus,zoneId:t.zoneId,buildingId:e.buildingId})})})),0===this.permissionSetting.roleAreas.length)this.permissionSetting.roleAreas=o;else{var n=!1;for(var l in o)for(var r in this.permissionSetting.roleAreas)if(o[l].title===this.permissionSetting.roleAreas[r].title)return n=!0,this.$toast(o[l].title+"已存在");n||o.forEach(function(e){t.permissionSetting.roleAreas.push(e)})}},removeArea:function(t){var e=this;this.permissionSetting.roleAreas.forEach(function(s,a){t.title===s.title&&e.permissionSetting.roleAreas.splice(a,1)})},_valueSelected:function(t,e){var s=this;if(this.permissionSetting.defaultValue[e]=t.value,"campusId"===e)this.permissionSetting.campusIds.splice(0,this.permissionSetting.campusIds.length),t.value.length>0&&(this.permissionSetting.campusIds=t.value.split(",")),this.permissionSetting.campusArray.forEach(function(e,a){t.value===e.value&&(s.permissionSetting.defaultValue.campus=e.label)}),this._getparkData();else if("parkId"===e)this.permissionSetting.zoneIds.splice(0,this.permissionSetting.zoneIds.length),t.value.length>0&&(this.permissionSetting.zoneIds=t.value.split(",")),this.permissionSetting.parkArray.forEach(function(e,a){t.value===e.zoneId&&(s.permissionSetting.defaultValue.park=e.name)}),this._getBuildingData();else if(t.value.length>0){var a=[];for(var i in a=(a=t.value.split(",")).sort(this.sortNumber),this.permissionSetting.defaultValue.building=[],a)for(var o in this.permissionSetting.buildingArray){if(a[i]===this.permissionSetting.buildingArray[o].buildingId)this.permissionSetting.defaultValue.building.indexOf(this.permissionSetting.buildingArray[o].name)<0&&this.permissionSetting.defaultValue.building.push(this.permissionSetting.buildingArray[o].name)}}else this.permissionSetting.defaultValue.building=[]},sortNumber:function(t,e){return t-e},_refreshTable:function(){this.timeStamp=Object(a.a)()}}},o={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container-fluid",attrs:{id:"premission"}},[s("div",{staticClass:"row"},[s("div",{directives:[{name:"show",rawName:"v-show",value:"role"===t.curRoute,expression:"curRoute === 'role'"}]},[s("v-table",{attrs:{url:t.roleUrl+"?timeStamp="+t.timeStamp,pagesize:"10",idField:"id",columns:t.roleColumns,order:!0,columnsControl:!1,search:!0}},[s("div",{staticClass:"btn-group pull-right",attrs:{slot:"btn-group",role:"group"},slot:"btn-group"},[s("button",{staticClass:"btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:t.showAddRoleModal}},[t._v("新增角色")]),t._v(" "),s("button",{staticClass:"btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:function(e){t.curRoute="user"}}},[t._v("切换到用户维度")])])])],1),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:"user"===t.curRoute,expression:"curRoute === 'user'"}]},[s("v-table",{attrs:{url:t.userUrl,pagesize:"10",idField:"id",columns:t.userColumns,order:!0,columnsControl:!1,search:!0}},[s("div",{staticClass:"btn-group pull-right",attrs:{slot:"btn-group",role:"group"},slot:"btn-group"},[s("button",{staticClass:"btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:function(e){t.curRoute="role"}}},[t._v("切换到角色维度")])])])],1)]),t._v(" "),s("v-modal",{attrs:{show:t.modalStatus.showAddModal,effect:"fade",width:"380"}},[s("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[s("h5",{staticClass:"modal-title"},[t._v("新增角色")])]),t._v(" "),s("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[s("div",{staticClass:"form-group"},[s("label",{staticClass:"input-label modal-label"},[t._v("角色名")]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.addRoleJson.name,expression:"addRoleJson.name"}],staticClass:"form-control form-input-style",attrs:{type:"text"},domProps:{value:t.addRoleJson.name},on:{input:function(e){e.target.composing||t.$set(t.addRoleJson,"name",e.target.value)}}})]),t._v(" "),s("div",{staticClass:"form-group"},[s("label",{staticClass:"input-label modal-textarea-label"},[t._v("角色说明")]),t._v(" "),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.addRoleJson.remark,expression:"addRoleJson.remark"}],staticClass:"modal-textarea-style",attrs:{cols:"24",rows:"5",maxlength:"600"},domProps:{value:t.addRoleJson.remark},on:{input:function(e){e.target.composing||t.$set(t.addRoleJson,"remark",e.target.value)}}})])]),t._v(" "),s("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[s("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){t.modalStatus.showAddModal=!1}}},[t._v(t._s(t.translate.cancel))]),t._v(" "),s("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:t.sumbitAddRole}},[t._v(t._s(t.translate.confirm))])])]),t._v(" "),s("v-modal",{attrs:{show:t.modalStatus.showEidtModal,effect:"fade",width:"350"}},[s("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[s("h5",{staticClass:"modal-title"},[t._v("编辑")])]),t._v(" "),s("div",{staticClass:"edit-modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[s("div",{staticClass:"modal-container"},[s("div",{staticClass:"form-group"},[s("label",{staticClass:"input-label modal-label"},[t._v("角色名")]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.editRoleJson.name,expression:"editRoleJson.name"}],staticClass:"form-control form-input-style",attrs:{type:"text"},domProps:{value:t.editRoleJson.name},on:{input:function(e){e.target.composing||t.$set(t.editRoleJson,"name",e.target.value)}}})]),t._v(" "),s("div",{staticClass:"form-group"},[s("label",{staticClass:"input-label modal-textarea-label"},[t._v("角色说明")]),t._v(" "),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.editRoleJson.remark,expression:"editRoleJson.remark"}],staticClass:"modal-textarea-style",attrs:{cols:"24",rows:"5",maxlength:"600"},domProps:{value:t.editRoleJson.remark},on:{input:function(e){e.target.composing||t.$set(t.editRoleJson,"remark",e.target.value)}}})])]),t._v(" "),s("div",{staticClass:"edit-card"},[s("div",{staticClass:"form-group"},[s("label",{staticClass:"input-label modal-label"},[t._v("用户检索")]),t._v(" "),t.editRoleJson.isShowSearch?s("detect",{staticClass:"search-user",attrs:{url:"/api/apartment/users/searchResults",placeholder:"用户姓名或学工号"},on:{afterSelected:t.userSelected}}):s("div",{staticStyle:{display:"inline-block"}},[s("div",{staticClass:"user-info"},[t._v("\n              "+t._s(t.editRoleJson.userInfo)+"\n              "),s("i",{staticClass:"maticon",domProps:{innerHTML:t._s(t.icons("edit"))},on:{click:t.changeUserSearch}},[t._v("edit")])])])],1)]),t._v(" "),t.editRoleJson.roleUsers.length>0?s("div",{staticClass:"user-list"},t._l(t.editRoleJson.roleUsers,function(e,a){return s("p",{key:a},[s("span",{staticClass:"user-name"},[t._v(t._s(e.name))]),t._v(" "),s("i",{staticClass:"maticon pull-right remove-icon",domProps:{innerHTML:t._s(t.icons("cancel"))},on:{click:function(s){return t.removeUser(e.userId)}}},[t._v("cancel")])])}),0):t._e()]),t._v(" "),s("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[s("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){t.modalStatus.showEidtModal=!1}}},[t._v(t._s(t.translate.cancel))]),t._v(" "),s("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:t.sumbitEditRole}},[t._v(t._s(t.translate.confirm))])])]),t._v(" "),s("v-modal",{attrs:{show:t.modalStatus.showSettingModal,effect:"fade",width:"885"}},[s("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[s("h5",{staticClass:"modal-title"},[t._v("配置")])]),t._v(" "),s("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[s("div",{staticClass:"form-group"},[s("label",{staticClass:"setting-label"},[t._v("权限配置")]),t._v(" "),s("div",t._l(t.permissionSetting.permissionArray,function(e,a){return s("div",{key:a,staticClass:"permission-options"},[s("span",{on:{click:function(s){return t.permissionSelected(e)}}},[t.permissionSetting.selected.indexOf(e.id)>=0?s("i",{staticClass:"maticon check-box",domProps:{innerHTML:t._s(t.icons("check_box"))}},[t._v("check_box")]):s("i",{staticClass:"maticon",domProps:{innerHTML:t._s(t.icons("check_box_outline_blank"))}},[t._v("check_box_outline_blank")])]),t._v(" "),s("span",{staticClass:"icon-title"},[t._v(t._s(e.name))])])}),0)]),t._v(" "),s("div",{staticClass:"area-select"},[s("label",{staticClass:"setting-label"},[t._v("片区选择")]),t._v(" "),s("div",{staticClass:"select-group"},[s("div",{staticClass:"form-group"},[s("label",{staticClass:"input-label"},[t._v("校区")]),t._v(" "),s("v-select",{staticClass:"btn-block form-select-style",attrs:{value:t.permissionSetting.defaultValue.campusId,options:t.permissionSetting.campusArray,optionsLabel:"label",optionsValue:"value",search:"","close-on-select":""},on:{afterSelected:function(e){return t._valueSelected(e,"campusId")}}})],1),t._v(" "),s("div",{staticClass:"form-group"},[s("label",{staticClass:"input-label"},[t._v("园区")]),t._v(" "),s("v-select",{staticClass:"btn-block form-select-style",attrs:{value:t.permissionSetting.defaultValue.parkId,options:t.permissionSetting.parkArray,optionsLabel:"name",optionsValue:"zoneId",search:"","close-on-select":""},on:{afterSelected:function(e){return t._valueSelected(e,"parkId")}}})],1),t._v(" "),s("div",{staticClass:"form-group"},[s("label",{staticClass:"input-label"},[t._v("楼栋")]),t._v(" "),s("v-select",{staticClass:"btn-block form-select-style",attrs:{value:t.permissionSetting.defaultValue.buildingId,options:t.permissionSetting.buildingArray,optionsLabel:"name",optionsValue:"buildingId",search:"",multiple:!0},on:{afterSelected:function(e){return t._valueSelected(e,"buildingId")}}})],1),t._v(" "),s("div",{staticClass:"form-group"},[s("button",{staticClass:"btn clearBtnBorder add-btn",attrs:{type:"button"},on:{click:t.addArea}},[t._v("添加")])])]),t._v(" "),t.permissionSetting.roleAreas.length>0?s("div",[s("label",{staticClass:"input-label pull-left"},[t._v("已添加片区")]),t._v(" "),s("div",{staticClass:"area-list pull-left"},t._l(t.permissionSetting.roleAreas,function(e,a){return s("div",[s("span",[t._v(t._s(e.title))]),t._v(" "),s("i",{staticClass:"maticon pull-right remove-icon",domProps:{innerHTML:t._s(t.icons("cancel"))},on:{click:function(s){return t.removeArea(e)}}},[t._v("cancel")])])}),0)]):t._e()])]),t._v(" "),s("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[s("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){t.modalStatus.showSettingModal=!1}}},[t._v(t._s(t.translate.cancel))]),t._v(" "),s("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:t.submitSettingRole}},[t._v(t._s(t.translate.confirm))])])])],1)},staticRenderFns:[]};var n=s("Mz/3")(i,o,!1,function(t){s("qoWu")},null,null);e.default=n.exports},qoWu:function(t,e){}});