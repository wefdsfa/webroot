webpackJsonp([50],{"4b5w":function(t,e){},aA9J:function(t,e,a){"use strict";e.a={data:function(){return{record:{id:"",resultRecord:"",canEditCounselor:!0,starNumber:0},stars:[{id:1,isSelected:!1},{id:2,isSelected:!1},{id:3,isSelected:!1},{id:4,isSelected:!1},{id:5,isSelected:!1}]}},methods:{changeStar:function(t){if(this.canEditCounselor)for(var e in this.record.starNumber=0,this.stars)this.stars[e].id<=t.id?(this.stars[e].isSelected=!0,this.record.starNumber++):this.stars[e].isSelected=!1}}}},dteg:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});a("wHeh");var s=a("C331"),r=a("aA9J"),i=(r.a,{mixins:[r.a],data:function(){return{url:"",timeStamp:"",columns:[],tableUrl:"",showRateCounselor:!1,statusLabel:{SUCCESS:"预约成功",CANCELED:"取消预约",CANCELED_BY_ADMIN:"后台取消",ING:"进行中",FINISHED:"已结束",DONE:"已完成",ABSENT:"未到",ABORT:"排班被取消"},setting:{cancelTip:""},lang:"zh-cn"}},computed:{translate:function(){return Object(s.f)(this.lang).employmentUnitManage}},created:function(){var t=localStorage.getItem("lang");Object(s.f)(t)&&(this.lang=t),this._getSetting(),this.initTable()},methods:{sumbitEditRecordModal:function(){var t=this;if(this.canEditCounselor){var e={teacherScore:this.record.starNumber,studentEvaluation:this.record.resultRecord},a="api/mentality/reservation/"+this.record.id+"/evaluations";Object(s.c)(a,e).then(function(e){e.state&&(t.$toast("评价成功!"),t.initTable(),t.showRateCounselor=!1)})}else this.showRateCounselor=!1},initTable:function(){var t=this;this.timeStamp=Object(s.a)(),this.tableUrl="/table-data/mentality/reservation/histories?timeStamp="+this.timeStamp,this.columns=[{id:"studentName",title:"姓名",width:120,className:"text-left",hidden:!1,formatter:function(t){return t.student?t.student.name:""}},{id:"studentNo",title:"学号",width:120,className:"text-left",hidden:!1,formatter:function(t){return t.student?t.student.userNo:""}},{id:"teacherName",title:"咨询师",width:100,className:"text-left",hidden:!1,search:{type:"input",data:{placeholer:"",autoFocus:!0}},formatter:function(t){return t.teacher?t.teacher.name:""}},{id:"timeQuantum",title:"预约时间段",width:80,className:"text-center no-wrap",hidden:!1,formatter:function(t){return t.dayTime&&t.dayTime.timeQuantum?t.dayTime.dateTime+" "+t.dayTime.timeQuantum:""}},{id:"createTime",title:"预约时间",width:80,className:"text-center no-wrap",hidden:!1},{id:"status",title:"状态",className:"text-center",width:100,search:{type:"select",data:{options:[{value:"SUCCESS",label:"预约成功"},{value:"CANCELED",label:"取消预约"},{value:"CANCELED_BY_ADMIN",label:"后台取消"},{value:"ING",label:"进行中"},{value:"FINISHED",label:"已结束"},{value:"DONE",label:"已完成"},{value:"ABSENT",label:"未到"},{value:"ABORT",label:"排班被取消"}],optionsLabel:"label",optionsValue:"value"}},hidden:!1,formatter:function(e){return t.statusLabel[e.status]}},{id:"opt",title:this.translate.opt,className:"text-left",width:130,hidden:!1,formatter:function(e){var a=[];return["SUCCESS","ING"].indexOf(e.status)>=0&&e.canCancelOnTime&&a.push({tag:"a",text:"取消预约",callback:function(e,a){t._cancelReservition(e)}}),"FINISHED"!==e.status&&"DONE"!==e.status||(e.teacherScore?a.push({tag:"a",text:"查看评分",callback:function(e,a){t.showCounselor(e,a)}}):a.push({tag:"a",text:"给咨询师评分",callback:function(e,a){t.rateCounselor(e,a)}})),a}}]},showCounselor:function(t,e){var a=this;this.record=t,this.record.starNumber=t.teacherScore,this.stars.forEach(function(t,e){e<a.record.starNumber&&(t.isSelected=!0)}),this.record.resultRecord=t.studentEvaluation,this.canEditCounselor=!1,this.showRateCounselor=!0},rateCounselor:function(t,e){var a=this;this.record=t,this.record.starNumber=0,this.stars.forEach(function(t,e){e<a.record.starNumber&&(t.isSelected=!0)}),this.record.resultRecord="",this.canEditCounselor=!0,this.showRateCounselor=!0},_getSetting:function(){var t=this;Object(s.d)({url:"/api/mentality/config",type:"get",success:function(e){e.state?t.setting=e.data:t.$toast(e.message)}})},_cancelReservition:function(t){var e=this;this.$prompt({tip:"取消预约原因",placeholder:"请在此处输入取消预约的原因",warn:this.setting.cancelTip,callback:function(a){if("ok"===a.type){if(!a.text)return e.$toast("请输入取消预约原因！"),!1;Object(s.d)({url:"/api/mentality/reservation/"+t.id+"/cancel",type:"put",data:{reason:a.text},success:function(t){t.state?(e.$toast("预约已取消"),e.timeStamp=Object(s.a)()):e.$toast(t.message)}})}}})}}}),o={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container-fluid",attrs:{id:"my-record"}},[a("div",{staticClass:"row text-center"},[a("v-table",{attrs:{url:t.tableUrl,pagesize:"10",idField:"id",columns:t.columns,multiple:!1,order:!0,search:!1}})],1),t._v(" "),a("v-modal",{attrs:{show:t.showRateCounselor,effect:"fade",width:"400"}},[a("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[a("h5",{staticClass:"modal-title"},[t._v("\n        编辑\n      ")])]),t._v(" "),a("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[a("div",{staticClass:"form-group"},[a("label",{staticClass:"form-label two-words-difference-margin"},[t._v("评星")]),t._v(" "),t._l(t.stars,function(e,s){return a("div",{key:s,staticClass:"stars-group"},[a("span",{on:{click:function(a){return t.changeStar(e)}}},[e.isSelected?a("i",{staticClass:"maticon",class:t.record.starNumber>3?"danger-color":"default-color",domProps:{innerHTML:t._s(t.icons("star"))}},[t._v("star")]):a("i",{staticClass:"maticon star-border",domProps:{innerHTML:t._s(t.icons("star_border"))}},[t._v("star_border")])])])})],2),t._v(" "),a("div",{staticClass:"form-group"},[a("label",{staticClass:"input-label textarea-label"},[t._v("评价")]),t._v(" "),a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.record.resultRecord,expression:"record.resultRecord"}],staticClass:"modal-textarea",attrs:{cols:"24",rows:"5",disabled:!t.canEditCounselor,maxlength:"300"},domProps:{value:t.record.resultRecord},on:{input:function(e){e.target.composing||t.$set(t.record,"resultRecord",e.target.value)}}})])]),t._v(" "),a("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[a("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){t.showRateCounselor=!1}}},[t._v("取消")]),t._v(" "),a("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:t.sumbitEditRecordModal}},[t._v("确定")])])])],1)},staticRenderFns:[]};var n=a("Mz/3")(i,o,!1,function(t){a("4b5w")},null,null);e.default=n.exports}});