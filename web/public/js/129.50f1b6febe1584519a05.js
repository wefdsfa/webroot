webpackJsonp([129],{VrBu:function(t,e){},fmhd:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});a("wHeh");var s=a("C331"),o={data:function(){return{url:"/table-data/apartment/buildings/getTableWithConditions",timeStamp:"",columns:[],importPage:!1,importParams:{parentPageTitle:"住宿资源管理列表",downloadTemplateUrl:"/apartment/buildings/batch/template",downloadErrorTemplateUrl:"/apartment/buildings/batch/error",checkTemplateUrl:"/apartment/buildings/batch/excel",templateName:"批量新增模板",importBtnType:null},accommodationResources:{campus:"",park:"",building:"",buildingProperty:"",code:""},modalType:"",showAddModal:!1,showAddTypeModal:!1,buildingPropertyData:[{id:"1",text:"男生楼栋"},{id:"2",text:"女生楼栋"},{id:"3",text:"混合楼栋"}],parkData:[],campusData:[],searchSelectOptions:{campusIds:[],zoneIds:[]},defineSearch:{campusIds:[],zoneIds:[],buildingNames:[],genders:[]},addBuilding:{buildingId:"",name:"",gender:"",code:"",zone:{name:"",campusName:""}},addTypeData:[{value:"single",label:"单个新增"},{value:"batch",label:"批量新增"}],addType:"single",selectOptions:{usedFor:[],toilet:[],haveBalcony:[],extraLongBed:[],furnitureType:[]},isShowCustomize:!1,customizeText:"自定义园区",customizeParkName:"",lang:"zh-cn"}},computed:{translate:function(){return Object(s.f)(this.lang).accommodationResources}},created:function(){var t=this,e=localStorage.getItem("lang");Object(s.f)(e)&&(this.lang=e),Object(s.d)({url:"/api/apartment/dicts?typeName=校区",type:"get",success:function(e){e.state?t.campusData=e.data||[]:t.$toast(e.message)}}),this._getZonesData([]),this._getSelectOptions(),this.columns=[{id:"campus",title:this.translate.campus,className:"text-left",width:100,hidden:!1,search:{type:"multiSelect",data:{url:"/api/apartment/dicts?typeName=校区",optionsLabel:"label",optionsValue:"value",change:function(e){e.value.length>0?t.defineSearch.campusIds=e.value.split(","):t.defineSearch.campusIds=[],t._getZonesData(t.defineSearch.campusIds)}}},formatter:function(t){return t.zone&&t.zone.campusName}},{id:"park",title:this.translate.park,className:"text-left",width:120,hidden:!1,search:{type:"multiSelect",data:{options:this.searchSelectOptions.zoneIds,optionsLabel:"label",optionsValue:"value",change:function(e){e.value.length>0?t.defineSearch.zoneIds=e.value.split(","):t.defineSearch.zoneIds=[]}}},formatter:function(t){return t.zone&&t.zone.name}},{id:"buildingName",title:this.translate.building,className:"text-left",width:100,hidden:!1,search:{type:"input",data:{placeholer:"",autoFocus:!0}},formatter:function(t){return t.name}},{id:"buildingProperty",title:this.translate.buildingProperty,className:"text-left",width:100,hidden:!1,search:{type:"multiSelect",data:{options:this.buildingPropertyData,optionsLabel:"text",optionsValue:"id",change:function(e){e.value.length>0?t.defineSearch.genders=e.value.split(","):t.defineSearch.genders=[]}}},formatter:function(e){var a="";return t.buildingPropertyData.forEach(function(t){e.gender===parseInt(t.id)&&(a=t.text)}),a}},{id:"code",title:"楼栋编号",className:"text-left",width:100,hidden:!1},{id:"floor",title:this.translate.numberOfLayers,className:"text-left",width:100,hidden:!1},{id:"roomPerFloor",title:this.translate.numberOfRooms,className:"text-left",width:100,hidden:!1},{id:"opt",title:this.translate.opt,className:"text-center",hidden:!1,formatter:function(e){return[{tag:"a",text:t.translate.edit,className:"opt-btn",callback:function(e,a){t.showAddModal=!0,t.modalType=t.translate.edit,t.accommodationResources={campus:e.zone.campusId,park:e.zone.zoneId,building:e.name,buildingProperty:e.gender.toString(),code:e.code};var s=!1;t.parkData.forEach(function(t){e.zone.zoneId.toString()===t.zoneId&&(s=!0)}),t.isShowCustomize=!s,t.isShowCustomize&&(t.customizeText="选择园区",t.customizeParkName=e.zone.name),t.addBuilding={buildingId:e.buildingId,name:e.name,gender:e.gender.toString(),code:e.code,zone:{name:e.zone.name,campusName:e.zone.campusName}}}},{tag:"a",text:t.translate.delete,className:"opt-btn",callback:function(e,a){confirm("确定删除吗？")&&Object(s.d)({url:"/api/apartment/buildings/deleteBuilding/"+e.buildingId,type:"delete",success:function(e){e.state?(t._refreshTable(),t.$toast("删除成功！")):t.toast(e.message)}})}},{tag:"a",text:t.translate.roomsList,className:"opt-btn",callback:function(e,a){t.$emit("addBread",{route:"/apartment/roomList?buildingId="+e.buildingId,title:e.zone.campusName+e.zone.name+"-房间列表",data:{selectOptions:t.selectOptions,buildingId:e.buildingId,floor:e.floor}})}},{tag:"a",text:t.translate.floorPlan,className:"opt-btn",callback:function(e,a){t.$emit("addBread",{route:"/apartment/floorPlan?buildingId="+e.buildingId,title:e.zone.campusName+e.zone.name+"-平面图",data:{buildingId:e.buildingId,floor:e.floor}})}}]}}]},methods:{changePark:function(){this.isShowCustomize=!this.isShowCustomize,this.customizeText=this.isShowCustomize?"选择园区":"自定义园区",this.accommodationResources.park="",this.customizeParkName=""},_selectAddType:function(t){this.addType=t.value},_sumbitTypeModal:function(){var t=this;"single"===this.addType?(this.showAddModal=!0,this.modalType=this.translate.add,this.accommodationResources={campus:"",park:"",building:"",buildingProperty:"",code:""}):(this.importPage=!0,this.importParams.parentPageTitle=this.translate.tableName,this.importParams.importBtnType=[{url:"/apartment/buildings/batch",method:"put",isShowBtn:!0,name:this.translate.overlayImport,success:function(e){e.state&&t._refreshTable()}}]),this.showAddTypeModal=!1},submit:function(){this.modalType===this.translate.add?this._add():this.modalType===this.translate.edit&&this._edit()},_parameterJudgment:function(){var t=!1;return this.accommodationResources.campus?this.accommodationResources.park||this.customizeParkName?this.accommodationResources.building?this.accommodationResources.buildingProperty?this.accommodationResources.code?t:(this.$toast("请输入楼栋编号"),!0):(this.$toast("请选择楼栋属性"),!0):(this.$toast("请输入楼栋名称"),!0):(this.$toast("请选择园区"),!0):(this.$toast("请选择校区"),!0)},_add:function(){var t=this;this._parameterJudgment()||(this.addBuilding.name=this.accommodationResources.building,this.addBuilding.code=this.accommodationResources.code,this.isShowCustomize&&(this.addBuilding.zone.name=this.customizeParkName),Object(s.d)({url:"/api/apartment/buildings/addBuilding",type:"post",data:this.addBuilding,success:function(e){e.state?(t.showAddModal=!1,t._refreshTable(),t.$toast("添加成功！")):t.$toast(e.message)}}))},_edit:function(){var t=this;this._parameterJudgment()||(this.addBuilding.name=this.accommodationResources.building,this.addBuilding.code=this.accommodationResources.code,Object(s.d)({url:"/api/apartment/buildings/updateBuilding",type:"post",data:this.addBuilding,success:function(e){e.state?(t.showAddModal=!1,t._refreshTable(),t.$toast("编辑成功！")):t.$toast(e.message)}}))},buildingPropertySelected:function(t){this.accommodationResources.buildingProperty=t.value,this.addBuilding.gender=t.value},campusSelected:function(t){var e=this;this.accommodationResources.campus=t.value;var a=[];t.value.length>0&&(a=t.value.split(",")),this.$nextTick(function(){e.addBuilding.zone.campusName=t.target.selected}),this._getZonesData(a)},changeCode:function(){if(!/^\+?[0-9][0-9]*$/.test(this.accommodationResources.code))return this.$toast("楼栋编号必须为正整数"),void(this.accommodationResources.code="")},_getZonesData:function(t){var e=this;Object(s.d)({url:"/api/apartment/zones/getByCampuses?campusIds="+t,type:"get",success:function(t){t.state?(e.parkData=t.data||[],e.searchSelectOptions.zoneIds.splice(0,e.searchSelectOptions.zoneIds.length),t.data&&t.data.forEach(function(t){e.searchSelectOptions.zoneIds.push({label:t.name,value:t.zoneId})})):e.$toast(t.message)}})},parkSelected:function(t){var e=this;this.accommodationResources.park=t.value,this.parkData.forEach(function(a){t.value===a.zoneId&&(e.addBuilding.zone.name=a.name)})},_refreshTable:function(){this.timeStamp=Object(s.a)()},_getSelectOptions:function(){var t=this;Object(s.d)({url:"/api/apartment/dicts?typeName=房间用途",type:"get",success:function(e){e.state?t.selectOptions.usedFor=e.data:t.toast(e.message)}}),Object(s.d)({url:"/api/apartment/dicts?typeName=卫生间类型",type:"get",success:function(e){e.state?t.selectOptions.toilet=e.data:t.toast(e.message)}}),Object(s.d)({url:"/api/apartment/dicts?typeName=家具类型",type:"get",success:function(e){e.state?t.selectOptions.furnitureType=e.data:t.toast(e.message)}}),Object(s.d)({url:"/api/apartment/dicts?typeName=是否加长床",type:"get",success:function(e){e.state?t.selectOptions.extraLongBed=e.data:t.toast(e.message)}}),Object(s.d)({url:"/api/apartment/dicts?typeName=有无阳台",type:"get",success:function(e){e.state?t.selectOptions.haveBalcony=e.data:t.toast(e.message)}})}}},i={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container-fluid",attrs:{id:"accommodation-resources"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:!t.importPage,expression:"!importPage"}],staticClass:"row text-center"},[a("v-table",{attrs:{title:t.translate.tableName,url:t.url+"?timeStamp="+t.timeStamp,pagesize:"10",idField:"id",columns:t.columns,multiple:!1,order:!0,search:!1,searchParams:t.defineSearch}},[a("div",{staticClass:"btn-group pull-right",attrs:{slot:"btn-group",role:"group"},slot:"btn-group"},[a("button",{staticClass:"btn add clearBtnBorder",attrs:{type:"button"},on:{click:function(e){t.showAddTypeModal=!0}}},[t._v(t._s(t.translate.add))])])])],1),t._v(" "),a("v-import",t._b({directives:[{name:"show",rawName:"v-show",value:t.importPage,expression:"importPage"}],on:{backParentPage:function(e){t.importPage=!1}}},"v-import",t.importParams,!1)),t._v(" "),a("v-modal",{attrs:{show:t.showAddTypeModal,effect:"fade",width:"400"}},[a("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[a("h5",{staticClass:"modal-title"},[t._v("选择新增类型")])]),t._v(" "),a("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[a("div",{staticClass:"info-item"},[a("div",{staticClass:"info-options"},t._l(t.addTypeData,function(e,s){return a("span",{key:s,on:{click:function(a){return t._selectAddType(e)}}},[a("i",{staticClass:"maticon",class:t.addType===e.value?"active":"",domProps:{innerHTML:t._s(t.icons(t.addType===e.value?"radio_button_checked":"radio_button_unchecked"))}}),t._v("\n            "+t._s(e.label)+"\n          ")])}),0)])]),t._v(" "),a("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[a("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){t.showAddTypeModal=!1}}},[t._v("取消")]),t._v(" "),a("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:t._sumbitTypeModal}},[t._v("确定")])])]),t._v(" "),a("v-modal",{attrs:{show:t.showAddModal,effect:"fade",width:"486"}},[a("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[a("h5",{staticClass:"modal-title"},[t._v(t._s(t.modalType))])]),t._v(" "),a("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[a("div",{staticClass:"form-group"},[a("label",{staticClass:"input-label modal-label"},[t._v(t._s(t.translate.campus))]),t._v(" "),a("v-select",{staticClass:"btn-block form-select-style",attrs:{value:t.accommodationResources.campus,options:t.campusData,"options-value":"value","options-label":"label",search:"","close-on-select":""},on:{afterSelected:t.campusSelected}})],1),t._v(" "),a("div",{staticClass:"form-group"},[a("label",{staticClass:"input-label modal-label"},[t._v(t._s(t.translate.park))]),t._v(" "),t.isShowCustomize?a("input",{directives:[{name:"model",rawName:"v-model",value:t.customizeParkName,expression:"customizeParkName"}],staticClass:"form-control search-input form-input-style",attrs:{type:"text"},domProps:{value:t.customizeParkName},on:{input:function(e){e.target.composing||(t.customizeParkName=e.target.value)}}}):a("v-select",{staticClass:"btn-block form-select-style",attrs:{value:t.accommodationResources.park,options:t.parkData,"options-value":"zoneId","options-label":"name",search:"","close-on-select":""},on:{afterSelected:t.parkSelected}}),t._v(" "),a("button",{staticClass:"btn check-btn clearBtnBorder",attrs:{type:"button"},on:{click:t.changePark}},[t._v(t._s(t.customizeText))])],1),t._v(" "),a("div",{staticClass:"form-group"},[a("label",{staticClass:"input-label modal-label"},[t._v(t._s(t.translate.building))]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.accommodationResources.building,expression:"accommodationResources.building"}],staticClass:"form-control search-input form-input-style",attrs:{type:"text"},domProps:{value:t.accommodationResources.building},on:{input:function(e){e.target.composing||t.$set(t.accommodationResources,"building",e.target.value)}}})]),t._v(" "),a("div",{staticClass:"form-group"},[a("label",{staticClass:"input-label modal-label"},[t._v(t._s(t.translate.buildingProperty))]),t._v(" "),a("v-select",{staticClass:"btn-block form-select-style",attrs:{value:t.accommodationResources.buildingProperty,options:t.buildingPropertyData,"options-value":"id","options-label":"text",search:"","close-on-select":""},on:{afterSelected:t.buildingPropertySelected}})],1),t._v(" "),a("div",{staticClass:"form-group"},[a("label",{staticClass:"input-label modal-label"},[t._v("楼栋编号")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.accommodationResources.code,expression:"accommodationResources.code"}],staticClass:"form-control search-input form-input-style",attrs:{type:"text"},domProps:{value:t.accommodationResources.code},on:{change:t.changeCode,input:function(e){e.target.composing||t.$set(t.accommodationResources,"code",e.target.value)}}})])]),t._v(" "),a("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[a("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){t.showAddModal=!1}}},[t._v(t._s(t.translate.cancel))]),t._v(" "),a("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:t.submit}},[t._v(t._s(t.translate.confirm))])])])],1)},staticRenderFns:[]};var n=a("Mz/3")(o,i,!1,function(t){a("VrBu")},null,null);e.default=n.exports}});