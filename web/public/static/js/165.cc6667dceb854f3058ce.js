webpackJsonp([165],{XrH7:function(t,e){},XshT:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("C331"),s={created:function(){var t=this,e=localStorage.getItem("lang");Object(n.g)(e)&&(this.lang=e),Object(n.e)({url:"/api/apartment/dicts?typeName=校区",type:"get",success:function(e){e.state?(e.data.forEach(function(e){t.singleChangingDormitory.options.campus.push({label:e.label,value:e.value})}),t._initColumns()):t.toast(e.message)}})},data:function(){return{columns:[],url:"/table-data/apartment/changes/uses/page",dormitory:{campusName:"",zoneName:"",floor:""},studentInfo:{userId:"",name:"",studentId:"",dormitory:"",userCheckInStatus:"",relCheckInTime:"",expectRetirementTime:""},changingStudentInfo:{userId:"",studentId:"",name:"",dormitory:"",userCheckInStatus:"",relCheckInTime:"",expectRetirementTime:""},changingDormitory:{},options:{educationLevel:[],grade:[{name:"2018",value:"2018"},{name:"2017",value:"2017"},{name:"2016",value:"2016"},{name:"2015",value:"2015"},{name:"2014",value:"2014"},{name:"2013",value:"2013"},{name:"2012",value:"2012"},{name:"2011",value:"2011"},{name:"2010",value:"2010"},{name:"2009",value:"2009"},{name:"2008",value:"2008"}]},singleChangingDormitory:{layoutOne:[{title:"校区:",id:"campus"},{title:"园区:",id:"zone"},{title:"宿舍楼:",id:"building"}],layoutTwo:[{title:"房号:",id:"dormitory"},{title:"床位:",id:"bed"}],options:{campus:[],zone:[],building:[],dormitory:[],bed:[]},defaultValue:{campus:"",zone:"",building:"",dormitory:"",bed:""}},showSingleChangingDormitoryModal:!1,showDoubleChangingDormitoryModal:!1,isShowSearch:!0,timeStamp:null,buildingData:[],lang:"zh-cn"}},computed:{translate:function(){return Object(n.g)(this.lang).changingDormitory}},methods:{_initColumns:function(){var t=this;this.columns=[{id:"name",title:this.translate.name,className:"text-left",hidden:!1,search:{type:"input",data:{autoFocus:!0,placeholder:this.translate.namePlaceholder}}},{id:"userNo",title:this.translate.studentId,className:"text-left",hidden:!1,search:{type:"input",data:{autoFocus:!0,placeholder:this.translate.studentIdPlaceholder}}},{id:"account",title:this.translate.account,className:"text-left",hidden:!1,width:150,search:{type:"input",data:{autoFocus:!0,placeholder:this.translate.accountIdPlaceholder}}},{id:"college",title:this.translate.college,className:"text-left",hidden:!1,width:120,search:{type:"multiSelect",data:{url:"/api/apartment/unit/list",optionsLabel:"name",optionsValue:"code"}}},{id:"educationLevel",title:this.translate.educationLevel,className:"text-left",hidden:!1,width:120,search:{type:"multiSelect",data:{url:"/api/apartment/dicts?typeName=培养层次",optionsLabel:"label",optionsValue:"value"}}},{id:"grade",title:this.translate.grade,className:"text-left",hidden:!1,width:80,search:{type:"multiSelect",data:{options:this.options.grade,optionsLabel:"name",optionsValue:"value"}}},{id:"apartment",title:this.translate.dormitory,className:"text-left",hidden:!1},{id:"opt",title:this.translate.opt,className:"text-left",hidden:!1,formatter:function(e){return[{tag:"a",text:t.translate.singleChangingDormitory,className:"opt-btn",callback:function(e,a){t.showSingleChangingDormitoryModal=!0,t.singleChangingDormitory.options.zone.splice(0,t.singleChangingDormitory.options.zone.length),t.singleChangingDormitory.options.building.splice(0,t.singleChangingDormitory.options.building.length),t.singleChangingDormitory.options.dormitory.splice(0,t.singleChangingDormitory.options.dormitory.length),t.singleChangingDormitory.options.bed.splice(0,t.singleChangingDormitory.options.bed.length),t.studentInfo.name="",t.studentInfo.userId="",t.studentInfo.expectRetirementTime="",t.studentInfo.relCheckInTime="",t.studentInfo.dormitory="",t.singleChangingDormitory.defaultValue.campus="",t.singleChangingDormitory.defaultValue.zone="",t.singleChangingDormitory.defaultValue.building="",t.singleChangingDormitory.defaultValue.dormitory="",t.singleChangingDormitory.defaultValue.bed="",Object(n.e)({url:"/api/apartment/users/apartmentInfos/"+e.userNo,dataType:"json",type:"get",success:function(e){if(e.state){var a=e.data;t.studentInfo.name=a.name,t.studentInfo.userId=a.userId,t.studentInfo.expectRetirementTime=a.expectRetirementTime,t.studentInfo.relCheckInTime=a.relCheckInTime,t.studentInfo.dormitory=a.apartment;t.studentInfo.userCheckInStatus={WAIT_CHECK_IN:"未入住",CHECK_IN:"入住",RETIREMENT:"退宿",ACCOMMODATION:"调宿"}[a.userCheckInStatus]}else t.toast(e.message)}})}},{tag:"a",text:t.translate.doubleChangingDormitory,className:"opt-btn",callback:function(e,a){t.showDoubleChangingDormitoryModal=!0,t.isShowSearch=!0,t.studentInfo.name="",t.studentInfo.userId="",t.studentInfo.expectRetirementTime="",t.studentInfo.relCheckInTime="",t.studentInfo.dormitory="",t.changingStudentInfo.userId="",t.changingStudentInfo.name="",t.changingStudentInfo.studentId="",t.changingStudentInfo.dormitory="",t.changingStudentInfo.userCheckInStatus="",t.changingStudentInfo.relCheckInTime="",t.changingStudentInfo.expectRetirementTime="",Object(n.e)({url:"/api/apartment/users/apartmentInfos/"+e.userNo,dataType:"json",type:"get",success:function(e){if(e.state){var a=e.data;t.studentInfo.name=a.name,t.studentInfo.userId=a.userId,t.studentInfo.expectRetirementTime=a.expectRetirementTime,t.studentInfo.relCheckInTime=a.relCheckInTime,t.studentInfo.dormitory=a.apartment;t.studentInfo.userCheckInStatus={WAIT_CHECK_IN:"未入住",CHECK_IN:"入住",RETIREMENT:"退宿",ACCOMMODATION:"调宿"}[a.userCheckInStatus]}else t.toast(e.message)}})}}]}}]},_doubleChangingDormitory:function(){var t=this;confirm(this.translate.changingDormitoryConfirmTip)&&Object(n.e)({url:"/api/apartment/changes/double/"+this.studentInfo.userId+"/"+this.changingStudentInfo.userId,dataType:"json",type:"put",success:function(e){e.state?(t.timeStamp=Object(n.a)(),t.showDoubleChangingDormitoryModal=!1,t.$toast("调宿成功！")):t.$toast("调宿失败！请输入互调学生学号或姓名！")}})},_cancelEditDoubleChangingDormitory:function(){this.showDoubleChangingDormitoryModal=!1},_showCheckFloorPlan:function(){this._floorPlanVerify()&&this.$emit("addBread",{route:"/apartment/floorPlan",title:this.dormitory.campusName+this.dormitory.zoneName+this.dormitory.name+"-平面图",reflash:!0,data:{buildingId:this.singleChangingDormitory.defaultValue.building,floor:10}})},studentIdSelected:function(t){var e=this;this.changingStudentInfo.studentId=t.userId,this.changingStudentInfo.name=t.name+" ("+t.userNo+")",Object(n.e)({url:"/api/apartment/users/apartmentInfos/"+t.userNo,dataType:"json",type:"get",success:function(t){if(t.state){var a=t.data;e.changingStudentInfo.userId=a.userId,e.changingStudentInfo.expectRetirementTime=a.expectRetirementTime,e.changingStudentInfo.relCheckInTime=a.relCheckInTime,e.changingStudentInfo.dormitory=a.apartment;e.changingStudentInfo.userCheckInStatus={WAIT_CHECK_IN:"未入住",CHECK_IN:"已入住",RETIREMENT:"退宿",ACCOMMODATION:"调宿"}[a.userCheckInStatus]}else e.$toast("未能查询到该生住宿信息！")}}),this.isShowSearch=!1},changeUserSearch:function(){this.isShowSearch=!0,this.changingStudentInfo.userId="",this.changingStudentInfo.name="",this.changingStudentInfo.studentId="",this.changingStudentInfo.dormitory="",this.changingStudentInfo.userCheckInStatus="",this.changingStudentInfo.relCheckInTime="",this.changingStudentInfo.expectRetirementTime=""},_optionsSelected:function(t,e){var a=this;this.singleChangingDormitory.defaultValue[e.id]=t.value,""===t.value||("campus"===e.id?this.$nextTick(function(){a.dormitory.campusName=t.target.selected,a._getZonesData(a.singleChangingDormitory.defaultValue[e.id])}):"zone"===e.id?(this.dormitory.name="",this.singleChangingDormitory.defaultValue.building="",this.$nextTick(function(){a.dormitory.zoneName=t.target.selected,a._getBuildingData(a.singleChangingDormitory.defaultValue[e.id])})):"building"===e.id?(this.buildingData.forEach(function(e){t.value===e.buildingId.toString()&&(a.dormitory.floor=e.floor,a.dormitory.name=e.name)}),this._getDormitoryData(this.singleChangingDormitory.defaultValue[e.id])):"dormitory"===e.id&&this._getBedData(this.singleChangingDormitory.defaultValue[e.id]))},_singleChangingDormitory:function(){var t=this;this._dormitoryVerify()&&confirm(this.translate.changingDormitoryConfirmTip)&&Object(n.e)({url:"/api/apartment/changes/single/"+this.studentInfo.userId,dataType:"json",type:"put",data:{campus:this.singleChangingDormitory.defaultValue.campus,zoneId:this.singleChangingDormitory.defaultValue.zone,buildingId:this.singleChangingDormitory.defaultValue.building,roomId:this.singleChangingDormitory.defaultValue.dormitory,bedId:this.singleChangingDormitory.defaultValue.bed},success:function(e){e.state?(t.timeStamp=Object(n.a)(),t.showSingleChangingDormitoryModal=!1,t.$toast("调宿成功！")):t.toast(e.message)}})},_dormitoryVerify:function(){var t=this,e=!0;return this.singleChangingDormitory.layoutOne.forEach(function(a){e&&!t.singleChangingDormitory.defaultValue[a.id]&&(t.$toast(a.title+"不能为空"),e=!1)}),this.singleChangingDormitory.layoutTwo.forEach(function(a){e&&!t.singleChangingDormitory.defaultValue[a.id]&&(t.$toast(a.title+"不能为空"),e=!1)}),e},_floorPlanVerify:function(){var t=this,e=!0;return this.singleChangingDormitory.layoutOne.forEach(function(a){e&&!t.singleChangingDormitory.defaultValue[a.id]&&(t.$toast(a.title+"不能为空"),e=!1)}),e},_getZonesData:function(t){var e=this;Object(n.e)({url:"/api/apartment/zones/getByCampuses/"+t,type:"get",success:function(t){t.state?(e.singleChangingDormitory.options.zone.splice(0,e.singleChangingDormitory.options.zone.length),t.data&&t.data.forEach(function(t){e.singleChangingDormitory.options.zone.push({label:t.name,value:t.zoneId.toString()})})):e.$toast(t.message)}})},_getBuildingData:function(t){var e=this;Object(n.e)({url:"/api/apartment/buildings/list/"+t,type:"get",success:function(t){t.state?(e.buildingData=t.data,e.singleChangingDormitory.options.building.splice(0,e.singleChangingDormitory.options.building.length),t.data&&t.data.forEach(function(t){e.singleChangingDormitory.options.building.push({label:t.name,value:t.buildingId.toString()})})):e.$toast(t.message)}})},_getDormitoryData:function(t){var e=this;Object(n.e)({url:"/api/apartment/rooms/list/"+t,type:"get",success:function(t){t.state?(e.singleChangingDormitory.options.dormitory.splice(0,e.singleChangingDormitory.options.dormitory.length),t.data&&t.data.forEach(function(t){e.singleChangingDormitory.options.dormitory.push({label:t.roomNo,value:t.roomId})})):e.$toast(t.message)}})},_getBedData:function(t){var e=this;Object(n.e)({url:"/api/apartment/beds/getBedsByRooms/"+t,type:"get",success:function(t){t.state?(e.singleChangingDormitory.options.bed.splice(0,e.singleChangingDormitory.options.bed.length),t.data&&t.data.forEach(function(t){e.singleChangingDormitory.options.bed.push({label:t.bedNo.toString(),value:t.bedId})})):e.$toast(t.message)}})}}},i={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container-fluid",attrs:{id:"changingDormitory-page"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:!t.importPage,expression:"!importPage"}],staticClass:"row text-center"},[a("v-table",{attrs:{title:t.translate.tableName,url:t.url+"?timeStamp="+t.timeStamp,pagesize:"10",idField:"id",columns:t.columns,order:!0,search:!0}})],1),t._v(" "),a("v-modal",{attrs:{show:t.showSingleChangingDormitoryModal,effect:"fade",width:"1000"}},[a("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[a("h5",{staticClass:"modal-title"},[t._v("\n        "+t._s(t.translate.singleChangingDormitory)+"\n      ")])]),t._v(" "),a("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[a("div",{staticClass:"form-group"},[a("label",{staticClass:"input-label"},[t._v(t._s(t.translate.currentStudentName)+": ")]),t._v(" "),a("label",{staticClass:"class-name-text"},[t._v(t._s(t.studentInfo.name))])]),t._v(" "),a("div",{staticClass:"form-group"},[a("label",{staticClass:"input-label"},[t._v(t._s(t.translate.dormitory)+": ")]),t._v(" "),a("label",{staticClass:"class-name-text"},[t._v(t._s(t.studentInfo.dormitory))])]),t._v(" "),a("div",{staticClass:"form-group"},[a("label",{staticClass:"input-label"},[t._v(t._s(t.translate.userCheckInStatus)+": ")]),t._v(" "),a("label",{staticClass:"class-name-text"},[t._v(t._s(t.studentInfo.userCheckInStatus))])]),t._v(" "),a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-4"},[a("label",{staticClass:"input-label"},[t._v(t._s(t.translate.relCheckInTime)+": ")]),t._v(" "),a("label",{staticClass:"class-name-text"},[t._v(t._s(t.studentInfo.relCheckInTime))])]),t._v(" "),a("div",{staticClass:"col-md-8"},[a("label",{staticClass:"input-label"},[t._v(t._s(t.translate.expectRetirementTime)+": ")]),t._v(" "),a("label",{staticClass:"class-name-text"},[t._v(t._s(t.studentInfo.expectRetirementTime))])])]),t._v(" "),t._l(t.singleChangingDormitory.layoutOne,function(e,n){return a("div",{key:n,staticClass:"form-group col-md-4"},[a("label",{staticClass:"input-label"},[t._v(t._s(e.title))]),t._v(" "),a("v-select",{staticClass:"btn-block form-select-style",attrs:{value:t.singleChangingDormitory.defaultValue[e.id],options:t.singleChangingDormitory.options[e.id],"options-value":"value","options-label":"label",search:"","close-on-select":""},on:{afterSelected:function(a){return t._optionsSelected(a,e)}}})],1)}),t._v(" "),t._l(t.singleChangingDormitory.layoutTwo,function(e,n){return a("div",{key:n,staticClass:"form-group col-md-4"},[a("label",{staticClass:"input-label"},[t._v(t._s(e.title))]),t._v(" "),a("v-select",{staticClass:"btn-block form-select-style",attrs:{value:t.singleChangingDormitory.defaultValue[e.id],options:t.singleChangingDormitory.options[e.id],"options-value":"value","options-label":"label",search:"","close-on-select":""},on:{afterSelected:function(a){return t._optionsSelected(a,e)}}})],1)}),t._v(" "),a("div",{staticClass:"col-md-4"},[a("button",{staticClass:"checkFloorPlanBtn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:t._showCheckFloorPlan}},[t._v(t._s(t.translate.checkFloorPlan))])])],2),t._v(" "),a("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[a("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){t.showSingleChangingDormitoryModal=!1}}},[t._v(t._s(t.translate.cancel))]),t._v(" "),a("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:t._singleChangingDormitory}},[t._v(t._s(t.translate.changingDormitory))])])]),t._v(" "),a("v-modal",{attrs:{show:t.showDoubleChangingDormitoryModal,effect:"fade",width:"800"}},[a("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[a("h5",{staticClass:"modal-title"},[t._v("\n        "+t._s(t.translate.doubleChangingDormitory)+"\n      ")])]),t._v(" "),a("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[a("div",{staticClass:"form-group"},[a("label",{staticClass:"input-label"},[t._v(t._s(t.translate.currentStudentName)+": ")]),t._v(" "),a("label",{staticClass:"class-name-text"},[t._v(t._s(t.studentInfo.name))])]),t._v(" "),a("div",{staticClass:"form-group"},[a("label",{staticClass:"input-label"},[t._v(t._s(t.translate.dormitory)+": ")]),t._v(" "),a("label",{staticClass:"class-name-text"},[t._v(t._s(t.studentInfo.dormitory))])]),t._v(" "),a("div",{staticClass:"form-group"},[a("label",{staticClass:"input-label"},[t._v(t._s(t.translate.userCheckInStatus)+": ")]),t._v(" "),a("label",{staticClass:"class-name-text"},[t._v(t._s(t.studentInfo.userCheckInStatus))])]),t._v(" "),a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-4"},[a("label",{staticClass:"input-label"},[t._v(t._s(t.translate.relCheckInTime)+": ")]),t._v(" "),a("label",{staticClass:"class-name-text"},[t._v(t._s(t.studentInfo.relCheckInTime))])]),t._v(" "),a("div",{staticClass:"col-md-8"},[a("label",{staticClass:"input-label"},[t._v(t._s(t.translate.expectRetirementTime)+": ")]),t._v(" "),a("label",{staticClass:"class-name-text"},[t._v(t._s(t.studentInfo.expectRetirementTime))])])]),t._v(" "),a("div",{staticClass:"modal-search-user"},[t.isShowSearch?a("detect",{attrs:{url:"/api/apartment/users/searchResults",placeholder:"请输入互调学生学号或姓名"},on:{afterSelected:t.studentIdSelected},model:{value:t.changingStudentInfo.studentId,callback:function(e){t.$set(t.changingStudentInfo,"studentId",e)},expression:"changingStudentInfo.studentId"}}):a("div",[a("div",{staticClass:"user-info pull-left"},[t._v(t._s(this.changingStudentInfo.name))]),t._v(" "),a("i",{staticClass:"maticon pull-left",domProps:{innerHTML:t._s(t.icons("edit"))},on:{click:t.changeUserSearch}},[t._v("edit")])])],1),t._v(" "),a("br"),t._v(" "),a("br"),t._v(" "),a("div",{staticClass:"form-group"},[a("label",{staticClass:"input-label"},[t._v(t._s(t.translate.dormitory)+": ")]),t._v(" "),a("label",{staticClass:"class-name-text"},[t._v(t._s(t.changingStudentInfo.dormitory))])]),t._v(" "),a("div",{staticClass:"form-group"},[a("label",{staticClass:"input-label"},[t._v(t._s(t.translate.userCheckInStatus)+": ")]),t._v(" "),a("label",{staticClass:"class-name-text"},[t._v(t._s(t.changingStudentInfo.userCheckInStatus))])]),t._v(" "),a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-4"},[a("label",{staticClass:"input-label"},[t._v(t._s(t.translate.relCheckInTime)+": ")]),t._v(" "),a("label",{staticClass:"class-name-text"},[t._v(t._s(t.changingStudentInfo.relCheckInTime))])]),t._v(" "),a("div",{staticClass:"col-md-8"},[a("label",{staticClass:"input-label"},[t._v(t._s(t.translate.expectRetirementTime)+": ")]),t._v(" "),a("label",{staticClass:"class-name-text"},[t._v(t._s(t.changingStudentInfo.expectRetirementTime))])])])]),t._v(" "),a("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[a("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:t._cancelEditDoubleChangingDormitory}},[t._v(t._s(t.translate.cancel))]),t._v(" "),a("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:t._doubleChangingDormitory}},[t._v(t._s(t.translate.changingDormitory))])])])],1)},staticRenderFns:[]};var o=a("C7Lr")(s,i,!1,function(t){a("XrH7")},null,null);e.default=o.exports}});